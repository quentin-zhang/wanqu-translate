建立用户的互动网站可以涉及发送JavaScript。通常,太多。你一直在移动页面看起来只加载,点击一个链接或试图滚动,会发生什么? 
 Byte-for-byte,JavaScript仍然是最昂贵的资源,我们发送到手机,因为它可以延迟交互性在大的方面。 
 今天我们将讨论一些策略可以使用JavaScript提供高效,同时为用户提供有价值的经验。 
 当用户访问你的网站你可能发送了大量的文件,其中许多是脚本。从web浏览器”的角度来看这看起来有点像这个: 
 我爱JavaScript,它总是最昂贵的部分你的网站。我想解释为什么这是一个大问题。 
 目前网页中位数今天船大约350 KB的简化和压缩JavaScript。未压缩的,阻塞超过1 mb的浏览器脚本需要过程。 
 注意:不确定如果你的JavaScript包延迟用户与网站交互的速度有多快?查看灯塔。 
 经验,船下来这么多JavaScript超过14 +秒加载和移动设备上的互动。 
 一个重要因素是需要多长时间在移动网络下载代码,然后处理它在移动CPU。 
 让我们看看移动网络。 
 从OpenSignal这个图表显示了如何在全球范围内持续4 g网络,每个国家的平均连接速度的用户体验。我们可以看到,许多国家仍然经历低比我们可以想象的连接速度。 
 不仅可以为网站中值350 KB的脚本之前需要一段时间来下载,事实是如果我们看看热门网站,他们实际上船比这更多的脚本: 
 我们达到这个上限在桌面和移动web站点在哪里有时航运多个浏览器的代码数mb然后需要过程。要问的问题是,你能负担得起这个JavaScript多少? 
 注意:如果你发送太多的脚本,可以考虑代码分隔分解包或减少使用tree-shaking JS载荷。 
 网站今天会发送以下的JS包: 
 这段代码增加。有越多,时间越长需要一个页面加载。 
 加载一个网页就像一个电影有三个关键时刻的带。 
 有:发生了什么?是有用的吗?,它是可用的吗? 
 这是发生的时刻你可以发布一些内容到屏幕上。(导航开始?服务器已开始回应了吗?) 
 它是有用的此刻,你画文本或内容,允许用户价值来源于经验和参与。 
 然后它是可用的此刻,用户可以开始有意义与经验交流,有什么发生。 
 我提到这个术语“互动”,但是这是什么意思? 
 一个页面是互动的,它必须能够快速响应用户输入。一个小JavaScript载荷可以确保这种情况发生得很快。 
 是否在用户点击一个链接,或者通过一个页面滚动,他们需要看到的东西实际上是发生在应对自己的行为。一个经验,这将阻挠你的用户无法送货。 
 一个地方这通常发生的是当人们端呈现一个经验,然后船很多JavaScript之后“水合物”界面(附加事件处理程序和额外的行为)。 
 当浏览器运行的许多事件你可能需要,很有可能会在同一个线程中处理用户输入。这个线程称为主线程。 
 太多的JavaScript加载到主线程(通过<脚本>等)问题。把JS网络工作者或通过服务工人没有相同的缓存Time-to-Interactive负面影响。 
  
 尽可能避免阻塞主线程。更多信息,见“为什么web开发人员需要关心互动” 
 我们看到团队合作伙伴遭受JavaScript影响互动在许多类型的网站。 
 太多(主线程)JavaScript可以延迟可见元素的交互性。这对许多公司可能是一个挑战。 
 上面几个例子从谷歌搜索,你可以开始开发UI,但如果一个网站是航运太多JavaScript,之前可能会有一个延迟实际发生的事情。这可以让用户感觉有点沮丧。理想情况下,我们希望所有体验互动尽快。 
 测量Time-to-Interactive谷歌新闻的移动,我们看到大方差之间的一个高端互动~ 7 s和低端设备互动在55年代。所以,良好的交互性的目标是什么? 
 时时间互动,我们觉得你的底线应该得到互动在5秒一个缓慢的3 g连接中移动设备上。“但是,我的用户都在快速网络和高端手机!“……是吗?你可能会在“快速”咖啡馆WiFi但实际上只得到2 g和3 g的速度。变化很重要。 
 谁有少运JavaScript和减少了Time-to-Interactive ? 
 让我们设计一个更有弹性的移动互联网并不像依赖大型JavaScript载荷。 
 很多东西互动影响。它可以影响一个人加载你的网站在移动数据计划,或咖啡店WiFi,或者只是他们在断断续续的连接。 
 当这种情况发生时,你有很多需要处理的JavaScript,最终用户可以等待网站呈现任何实际行动。或者,如果确实有呈现,他们可以等待很长时间才能与页面上的任何东西。理想情况下,船运减少JavaScript将缓解这些问题。 
 解释如何JavaScript可以有这么大的成本,我想带您经历当你将内容发送到浏览器。用户输入一个网址到浏览器的地址栏: 
 一个请求发送到服务器,然后返回一些标记。然后浏览器解析标记和发现必要的CSS,JavaScript和图片。然后,浏览器获取并处理所有这些资源。 
 上面的场景是一个精确的描述发生在Chrome当它处理所有你发送(是的,这是一个巨大的emoji工厂)。 
 的一个挑战是,JavaScript是一个瓶颈。理想情况下,我们希望能够迅速油漆像素,然后页面交互。但如果JavaScript是一个瓶颈,最终你可以看的东西你不能实际接触。 
 我们要防止JavaScript瓶颈现代经验。 
 一件事要记住作为一个行业,如果我们想要快速JavaScript,我们必须下载,解析它,很快地把它编译和执行。 
 这意味着我们必须快速网络传输和处理方面为我们的脚本。 
 如果你花很长时间在JavaScript引擎解析和编译脚本,,延迟多久用户可以与你的经历。 
 提供一些数据,这是一个崩溃的V8(Chrome的JavaScript引擎)花时间处理页面包含脚本: 
 橙色代表所有流行的网站发送的时间解析JavaScript。黄色,是编译所花费的时间。这些花费30%的时间来处理你的页面的JavaScript——这是一个真正的成本。 
 截至66年Chrome,V8编译代码在一个后台线程,减少编译时间20%。但解析和编译仍然非常昂贵,难得看到一个大的脚本实际执行在50微秒 
 ,即使off-thread编译。 
 另一件要记住使用JavaScript是所有字节是不平等的。一个200 KB的脚本和一个200 KB的形象有不同的成本。 
 他们可能会采取相同的时间下载,但处理时需要我们处理不同的成本。 
 JPEG图像需要解码,点阵,并在屏幕上画。一个JavaScript包需要下载,然后解析,编译、执行——有许多其他步骤,一个引擎需要完成。只是意识到这些成本是不相同的。 
 的原因之一他们开始增加和物质是移动。 
 如果我们幸运的话,我们可能有一个高端或中等结束电话。现实情况是,并不是所有的用户将这些设备。 
 他们可能在低端或中位数电话,和这些多个类的设备之间的差异是非常鲜明的原因;热节流、缓存大小的差异、CPU、GPU——你可以最终经历完全不同处理时间对资源像JavaScript,这取决于您所使用的设备。用户在低端手机甚至可能在美国 
 这里的分解需要多长时间来解析JavaScript在2018年可用的硬件: 
 顶部有高端设备,像iPhone 8,过程脚本相对较快。降低我们有更多的普通手机Moto G4和阿尔卡特1 x < 100美元。注意到处理时间的差异吗? 
 Android手机越来越便宜,而不是更快,随着时间的推移。这些设备通常是CPU可怜小L2 / L3缓存大小。你没有普通用户如果你希望他们都有高端硬件。 
 让我们来看一个更实际的版本,这个问题从一个真实的网站使用脚本。这是CNN.com的JS处理时间: 
 在iPhone上8(使用A11芯片)需要9秒处理CNN的JavaScript低于平均的电话。这是9秒更快体验可以互动。 
 既然WebPageTest支持阿尔卡特1 x(~ 100美元的手机在美国出售。年代,卖完了在发射)我们也可以看幻灯片,CNN在中低加载端硬件。缓慢甚至不开始描述: 
 这暗示,也许我们需要停止服用快网络和快速设备是理所当然的。 
 一些用户不会在高速网络或有最新最好的手机,这是至关重要的,我们开始测试真正的手机和网络。变化是一个真正的问题。 
 “变化就是杀死用户体验”——Ilya Grigorik。快速的设备可以有时是缓慢的。快速的网络可能会很慢,可变性最终能做出一切缓慢。 
 当方差可以杀死用户体验,发展缓慢的基线可以确保每个人都在快速和慢速设置()的好处。如果你的团队可以看看他们的分析和理解什么设备用户访问你的网站,会给你一个暗示什么设备,你应该在办公室测试你的网站。 
 webpagetest.org/easy有很多摩托G4预配置在“移动”下配置文件。这是有价值的,以防你无法购买的median-class硬件进行测试。 
 有数量的配置文件设置,您可以使用今天已经流行的设备配置。例如,我们有一些中间移动设备如摩托G4准备测试。 
 测试代表网络也很重要。虽然我已经讲过低端和中位数的手机是多么重要,布莱恩·霍尔特让这个伟大的观点:真的很重要知道你的听众。 
 并不是每个网站都需要执行2 g低端手机。也就是说,瞄准高水平的性能在整个频谱并不是一件坏事。 
 你可能有一个广泛的用户 
 更高的一方面,或在不同光谱的一部分。只是知道你的网站背后的数据,这样你就可以做出一个合理的拜访多少这两者都很重要。 
 如果你想要快速JavaScript,注意为低端网络下载时间。的进步有:船更少的代码,贬低你的来源,利用压缩(即。,Brotli gzip和Zopfli)。 
 利用重复访问的缓存。解析时间cpu速度较慢的手机来说是至关重要的。 
 如果你是一个后端或完整的堆栈开发人员,你知道你得到你支付对CPU、磁盘和网络。 
 当我们越来越依赖于JavaScript构建网站,我们有时会支付我们发送下来的方式并不总是很容易看到。 
 成功的形状是什么让我们最少的脚本发送给用户,同时给他们一个有用的经验。代码分隔是一种选择,使之成为可能。 
 代码分隔是这个想法,而不是航运了你的用户大规模整体JavaScript包——就像一个巨大的满披萨——如果你只是送他们一次一片吗?足够的脚本需要当前页面可用。 
 代码分隔可以在页面级别,路线,或组件级别。它的许多现代库和框架支持通过打包机webpack和包裹。指南完成这个可供反应,Vue。js和角。 
 许多大型团队看到大赢了最近的投资代码分隔。 
 为了改写他们的移动网络体验,试图确保用户能够尽快与他们的网站,Twitter和易燃物在任何地方看到多达50%的改善时间互动时采用激进的代码分离。 
 栈像盖茨比一样。js(反应)、超前CLI和PWA Starter Kit试图执行好默认加载和交互式快速平均移动硬件。 
 许多这些网站所做的另一件事是采用审计作为工作流的一部分。 
 值得庆幸的是,JavaScript生态系统也有许多很棒的工具来帮助包分析。 
 工具如Webpack包分析器,源图Explorer和包朋友让你审核你的包修剪下来的机会。 
 这些工具可视化您的JavaScript的内容包:他们强调大型图书馆,重复的代码,你可能不需要的依赖关系。 
 包审计往往强调机会交换沉重的依赖项(如时刻。js和地区)轻的替代品(如date-fns)。 
 如果你使用webpack,您可能会发现我们共同库的库包有用的问题。 
 如果你不确定你是否有任何问题与JavaScript性能一般来说,看看灯塔: 
 灯塔是一种工具烤到Chrome开发工具。它也可以作为Chrome扩展。它给你一个深入的性能分析,强调了提高性能的机会。 
 我们最近增加了支持萎靡不振的高“JavaScript启动时间”灯塔。这个审计强调脚本解析/编译,可能会花费很长时间,延误交互性。你可以看看这个审计机会要么分手这些脚本,或者只是做更少的工作。 
 另一件你能做的就是确保你没有发货未使用的代码到你的用户: 
 代码覆盖率是DevTools特性允许您发现未使用JavaScript和CSS)在你的页面。加载一个页面在DevTools和覆盖选项卡将显示多少代码被执行死刑与加载是多少。你可以提高你的页面的性能只航运用户需要的代码。 
 提示:使用保险记录,您可以与应用程序交互和DevTools将更新如何工作 
 h(你的包。 
 这可能是有价值的对于识别机会分手脚本和推迟非关键的加载,直到他们需要。 
 如果你正在寻找一个模式为JavaScript有效地服务用户,查看PRPL模式。 
 PRPL(推,渲染,Precache和延迟加载)是积极的模式分解代码对于每个单独的路线,然后利用服务职工pre-cache未来所需的JavaScript和逻辑路线,并根据需要延迟加载它。 
 这意味着,当用户导航到其他视图的经验,很有可能已经在浏览器缓存,所以他们经历更多降低成本的启动脚本和互动。 
 如果你关心你曾经合作过的性能或为您的站点性能补丁,你知道有时候你可能最终在修复工作,几周后回来,找你的团队工作特性和无意中打破了经验。它有点像这个: 
 值得庆幸的是,有很多方法我们可以我们可以尝试解决这一问题,方法之一是绩效预算。 
 绩效预算是至关重要的,因为他们让每个人都在同一页上。他们创造的文化共享的热情不断提高用户体验和团队责任感。 
 预算的定义可衡量的约束允许一个团队,以满足性能目标。当你不得不生活在预算的约束,性能是一个考虑每一步,而不是恍然大悟。 
 基于工作的蒂姆•Kadlec穿孔预算指标可以包括: 
 亚历克斯·罗素有tweet-storm绩效预算有一个值得注意的几个要点: 
 人影响一个网站的用户体验如何执行的关系。 
 性能往往是一种文化比一个技术挑战。 
 计划会议期间讨论性能和其他聚会。问业务涉众的期望性能。他们了解性能会影响他们关心的业务指标吗?问eng。团队他们计划如何解决性能瓶颈。虽然这里的答案可以不满意,他们展开对话。 
 性能:这是一个行动计划,创建你的表现视野。这是一个单页协议业务涉众和开发人员认为“好表现”,设置绩效预算。从视觉上提取关键绩效指标(kpi)和设定现实的,可衡量的目标。如5 s“负载和互动”。大小的预算可以脱落。e。g“保持JS < 170 kb大小/压缩”——创建常规报告kpi。这可能是一个定期报告发送到业务突出的进步和成功。 
 Web性能战士安迪仍然由劳拉霍根和设计性能都是优秀的书籍,讨论如何思考绩效文化的地方。 
 工具性能预算呢?你可以设置灯塔得分在持续集成与灯塔CI项目预算: 
 许多性能监视服务支持设置穿孔预算和预算警报包括口径,Treo,Webdash SpeedCurve: 
 拥抱绩效预算鼓励团队认真思考他们做出任何决定的后果在设计的早期阶段一直到结束的一个里程碑。 
 寻找进一步参考?U。年代数字服务文档的方法来跟踪性能与灯塔通过设置目标和预算Time-to-Interactive等指标。 
 接下来. . 
 每个站点都应该访问实验室和现场性能数据。 
 跟踪JavaScript可以对用户体验的影响在朗姆酒(真实用户监控)环境中,有两件事 
 荷兰国际集团(ing)web我建议。 
 第一个是长期任务——一个API使您收集真实的遥测任务(和他们认为脚本),去年超过50毫秒可能阻塞主线程。你可以记录这些任务和日志回到你的分析。 
 第一个输入延迟(FID)是一种度量,措施的时间当用户第一次与你的网站(比如点击一个按钮时)的时候浏览器实际上是能够响应的互动。FID仍然是一个早期的指标,但我们有一个polyfill今天,你可以看看。 
 在这两个之间,你应该能够得到真实用户足够的遥测,看看他们跑到JavaScript性能问题。 
 众所周知,第三方JavaScript可以对页面加载性能产生严重的影响。虽然这是真的,重要的是要承认,今天的许多经历自己的船很多自身的JavaScript,。如果我们加载迅速,我们需要削弱这个问题对双方的影响用户体验。 
 有几种常见的疏忽我们看到,包括团队使用阻塞JavaScript在文档头部决定A / B测试显示用户。Or,航运的所有变体的JS A/B测试down,即使只有一个实际上?使用 
 我们有一个单独的指南加载第三方JavaScript如果这是目前你经历的主要瓶颈。 
 性能是一个旅程。许多小的变化可以导致大的收益。 
 让用户与网站交互用最少的摩擦。运行JavaScript的最小数量提供真正的价值。这可能意味着采取渐进的步骤。 
 最后,用户会感谢你的。 
 参考文献 
 非常感谢托马斯•施泰纳亚历克斯·罗素,杰里米·瓦格纳Patrick Hulce汤姆·安加和Houssein Djirdeh的帐面价值的贡献。也感谢帕特Meenan WebPageTest继续工作——这是一个灯塔报告这个页面如果感兴趣。你可以在Twitter上关注我的工作。 
 从一个快速起立鼓掌欢呼,鼓掌能表示你吃得多喜欢这个故事。 
 Eng。经理在Google Chrome•热爱使网络上工作快。 
  
   
  URL : https://medium.com/@addyosmani/the-cost-of-javascript-in-2018-7d8950fbb5d4?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website