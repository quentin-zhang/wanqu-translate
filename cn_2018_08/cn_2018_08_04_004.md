Goodreads,我们目前在分解的过程中整体microservices Rails应用程序。对于绝大多数的这些服务,我们决定使用亚马逊DynamoDB作为主要的数据存储。我们喜欢DynamoDB因为它给了我们一致的,single-digit-millisecond跨多种存储性能和吞吐量的需求。 
 尽管DynamoDB擅长高通量读写工作负载,它不是优化支持一次性临时查询或数据仓库的工作负载。然而,通过结合AWS数据管道,Amazon S3,AWS胶水,和亚马逊雅典娜我们可以导出数据集从DynamoDB S3和使用雅典娜运行数据集的SQL查询。 
  
 这个过程我们的架构如下: 
 我们可以查询以JSON格式的数据,从而消除拼花的额外的步骤转换。然而,我们决定做出额外的努力,因为拼花是空间和高性能。对于更大的数据集,这种方法将不仅转化为更快的查询,而且节约成本。 
 描述我们的体系结构的主要组件。 
 数据管道是一个编排服务为旋转亚马逊EMR集群使用大数据技术和容错运行工作像Apache猪,Apache蜂巢,或Apache火花。数据管道提供了一个模板从任意DynamoDB表导出数据到Amazon S3。我们使用一个标准出口模板的修改版本。 
 在这个版本中,我们增加能力在亚马逊SNS发送成功或失败的消息。这样做让我们使用Lambda启动进一步的处理以外的数据管道服务。 
 AWS胶水在这个体系结构中使用三种不同的方式: 
 雅典娜数据后用于AWS胶水数据目录。在这一点上,你可以查询它在雅典娜ANSI SQL。 
 在这个过程中,我们使用AWS CloudFormation来管理我们的AWS资源。我们把各种AWS资源跨三个堆栈,使它们更可组合。 
 的评论。yaml模板定义了一个示例DynamoDB表称为评论。常见的。yaml模板包含我在堆栈和S3资源共享。dynamodb-exports。yaml模板定义了一个数据管道,Lambda函数,AWS胶工作,AWS胶水爬虫。 
 的评论。yaml CloudFormation模板包含一个简单的DynamoDB表定义用于存储用户评论的书。我们使用一个散列键和排序键结构,巢每个评论一本书在一个特定的用户。这个结构允许应用程序检查用户是否有评论一本书在一个简单的get操作,也列出所有用户评论。 
 表中定义的评论。yaml是一种散列密钥和密钥表。用户属性是散列键,和这本书的属性是关键。如果你构建一个应用程序在这个表中,可以添加额外的全球二级索引(GSIs),以适应其他访问模式,例如加权评价最高的一本书。 
 首先,您创建一个CloudFormation堆栈: 
 接下来,您创建测试项目在评审表中。CREATE_COMPLETE ReviewsStack状态之后,您可以打开DynamoDB控制台和探索。让我们添加一些条目表: 
  
  
 现在让我们添加一个条目。 
 你可以看到,我们添加了一些不同的字段,没有指定的表模式。值得注意的是,这些都是:评级,评论,和作者。因为DynamoDB NoSQL数据库,我们可以添加新属性随着我们的应用程序的发展。然而,对那些属性有效聚合,他们要么需要在表创建主键的一部分模式或上定义索引。 
 Goodreads评论表没有什么不同于我们的示例表。然而,我们使用我们的最大的全球五大二级索引(GSIs)来支持我们的用户最需要的访问模式。它不再是一个该俱乐部 
 n为我们创造短暂GSIs回答任意的问题,我们有我们的数据。即使我们可以,我们有这么多数据,创建一个GSI创造了几天。 
 现在想象一下,我们的产品团队想要运行在任意的作者的评论数据查询。我们不能添加一个额外的助教,和在生产中所需的访问模式并不是。但是,通过使用这篇文章中描述的架构我们可以打开我们的产品团队的数据集。 
 随时添加更多的项目表,因为更多的数据表中你有当我们出口它更有趣的SQL查询您可以运行在雅典娜。 
 常见的。yaml CloudFormation模板创建一个各种各样的我和EC2权限数据管道,λ,AWS胶使用。此外,该模板创建一个S3 bucket存储DynamoDB出口。需要的资源引用在栈中声明输出部分。 
 创建CloudFormation堆栈如下: 
 dynamodb-exports。yaml模板是一个自包含的模板来创建一个数据管道,SNS的话题,λ触发,AWS胶工作,和一个AWS胶履带对于任何给定DynamoDB表。如果你有多个DynamoDB表你想出口,你可以重用dynamodb-exports。yaml模板并为每个表创建一个堆栈。 
 最有趣的部分这个堆栈AWS胶工作脚本,将任意DynamoDB导出文件创建的数据管道任务拼花。也从原始JSON中删除DynamoDB类型信息通过使用Boto3,可用在PySpark AWS胶环境。代码是证据确凿的,所以不要犹豫,在这里如果你感兴趣如何编写一个定制的AWS胶工作。 
 创建CloudFormation堆栈如下: 
 ExportTimeout:1 
 MaxConsumedReadThroughput:0.5 
 表名:评论 
 管道从DynamoDB Apache蜂巢目录是完全自动的。部署CloudFormation堆栈出口评论之后,数据管道开始了。你很快就可以查询中的数据雅典娜。 
 监控数据管道: 
  
  
  
  
 管道出口成功发送一条消息SNS的话题。这样做触发器调用AWSλJSON输出转换为拼花胶的工作。 
 让我们监视AWS胶工作: 
  
 接下来,AWS胶履带运行: 
  
 第一次爬行器运行时,它添加了评论表在AWS胶dynamodb-exports数据库数据目录。如果你积累更多的出口快照爬虫运行后,后续运行履带添加新分区的表, 
 接下来,看看评论表: 
  
  
 AWS胶数据目录是一个Apache Hive-compatible metastore存储数据集的模式。它存储属性,如对象计数和数据集的位置在S3中,其他数据。 
 看看模式时,您可能注意到ddb_export_timestamp列,而不是最初的一部分属性,我们在DynamoDB添加到项目。根据键列,ddb_export_timestamp被标记为分区(0)。分区列就像普通列,当他们在雅典娜WHERE子句中使用允许您限制扫描的数据量。雅典娜分区文档是一个开始的好地方,如果你想知道更多。 
 Lambda函数调用铺转换脚本提供这种额外的元数据。所以,当AWS胶履带推断模式,给出了分区一个有用的名字,而不是默认partition_N名称,如果没有给出分区名称。 
 使用雅典娜查询数据集,把这些步骤: 
  
  
 你刚跑了一个SQL查询DynamoDB数据集!让我们运行一个聚合计算有多少评论J.K.罗琳。您可能还记得,这个访问模式并不支持DynamoDB表设计。 
 你可能会看到不同的r 
 结果如果你添加更多的项目,但这是我们看到的结果在我们的桌子上。 
  
 雅典娜,在大小和复杂性随着你的数据,你可以从DynamoDB拉见解的数据使用ANSI SQL。 
 这里有一些方法可以扩展这个工作: 
 在这篇文章中,我们向您展示如何从DynamoDB表导出数据,将其转换成一个更有效的格式与AWS胶水,与雅典娜和查询数据。这种方法使你从你的数据存储在DynamoDB拉的见解。 
 如果你发现这篇文章很有用,一定要看看这些: 
   
 乔·费尼亚马逊作者团队是一个软件工程师,他利用亚马逊的所有数据为作者提供独特的、可操作的见解。他喜欢在马里奥赛车失去了他的妻子和孩子,和建立和修改吉他。 
   
   
   
 亚马逊网络服务是招聘。 
 亚马逊网络服务(AWS)是一个动态的,不断增长的业务单元在Amazon.com。我们目前正在招聘软件开发工程师、产品经理、账户管理,解决方案架构师,支持工程师、系统工程师、设计师等等。访问我们的职业页面来了解更多信息。 
   
 Amazon.com是一个平等Opportunity-Affirmative行动雇主——少数/女/残疾/经验/性别认同和性取向。 
   
   
  
   
  URL : https://aws.amazon.com/blogs/big-data/how-goodreads-offloads-amazon-dynamodb-tables-to-amazon-s3-and-queries-them-using-amazon-athena/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website