onments做超过每秒~ 3400登录;使用新的工具更易于扩展,只要是有意义的。我们实现的自动化水平是不完美但让我们长到新的地区和在一个更方便的方式创建新环境。 
 写更好的剧本:有更多的时间和关注,我们看到,除了自动化我们也需要更好的剧本为了理解,管理和应对日益增长的网格服务的事件相关。这大大改善可伸缩性和可靠性,同时也让我们在新员工更快。 
 “写作更好的自动化让我们从部分自动化环境做~每秒300登录完全自动化的环境做超过每秒~ 3400登录” 
 推特这 
  
  
  
 让我们看看我们环境架构,例如。我们有一个总体结构: 
  
  
  
 这是结构在一个阿兹: 
  
  
  
 在本例中,我们使用两个AWS区域:us-west-2(主要)和us-west-1(我们的故障转移)。在正常情况下,所有的请求将us-west-2,由三个独立的服务可用性区域。 
 这就是我们如何实现高可用性:所有的服务(包括数据库)在每一个可用性区域运行的实例(AZ)。如果一个阿兹是由于数据中心故障,我们仍然有两个阿兹为请求服务。如果整个地区下降或有错误,我们可以更新Route53 us-west-1故障转移和恢复操作。 
 “我们实现高可用性通过运行所有服务在每一个AWS实例可用性区域” 
 推特这 
  
  
  
 我们有不同的成熟度级别的服务故障恢复:一些服务,比如用户搜索v2(Elasticsearch建立缓存)可能会工作,但略显陈旧的数据;不过,核心功能将按预期工作。 
 在数据层,我们使用: 
 MongoDB集群区域。 
 RDS PostgreSQL的复制。 
 每个地区集群Elasticsearch与自动快照和恢复运行定期占区域集群的缺乏。 
 我们锻炼故障转移至少每年一次,我们有剧本和自动化,帮助新的基础设施工程师达到速度如何,有何影响。 
 我们部署通常是由一个詹金斯节点;根据服务我们要么使用傀儡,SaltStack,和/或Ansible更新个人或团体的节点,或者我们更新我们的艾米斯和创建新的自动定量组为不可变的部署。我们有不同类型的新老服务的部署,这在很大程度上已被证明是无效的,我们需要维护自动化、文档和监控的东西应该是统一的。 
 我们正在推出蓝色/绿色的一些核心服务的部署,我们打算实现相同的每一个核心和支持服务。 
 除了单元测试覆盖在每一个项目,我们有多个功能测试套件运行在每个环境;我们运行它登台环境部署到生产环境之前,我们在生产完成后再次部署运行它们,以确保一切正常。 
 亮点: 
 我们有成千上万的单元测试在不同的项目。 
 我们使用Pingdom探测器运行每一分钟检查核心功能。 
 我们使用硒和CodeceptJS-based功能测试之前和之后的每一个部署。功能测试套件测试不同的API端点,身份验证流,身份提供者,和更多。 
 “除了单元测试覆盖率在每个项目中,我们有多个功能测试套件运行在每个环境:分段部署到生产环境之前,在生产完成后再次部署。” 
 推特这 
  
  
  
  
 直到2017年我们跑自己的,定制的CDN使用NGINX,清漆和EC2节点在多个地区。从那时起,我们转换到CloudFront,给我们许多好处,包括: 
 更多的边缘位置,这意味着更少的延迟为我们的客户。 
 较低的维护成本。 
 更容易配置。 
 有一些缺点,比如我们需要运行λ执行一些配置(比如PDF文件添加自定义标题,等等)。不过,好处肯定弥补。 
 我们提供的功能之一是能够运行自定义代码作为登录交易的一部分,通过身份验证规则或自定义数据库连接。这些特性是由扩展,一个可扩展的平台,源于Auth0和目前正在使用的其他公司。与扩展,我们的客户可以写任何他们想要的那些脚本和规则,使他们能够扩展配置文件,规范化属性,发送通知,等等。 
 我们有专门为Auth0扩展集群;他们使用EC2伸缩组、码头工人容器,从我们的租户和自定义代理来处理请求,处理成千上万的每秒请求和响应快速变化的负载。更多细节这是如何构建和运行,看看这篇文章就如何构建自己的serverless平台。 
 我们使用不同的工具来监控和调试问题: 
 CloudWatch 
 DataDog 
 Pingdom 
 SENTINL 
 绝大多数来自监测和DataDog的警报。 
 我们倾向于配置监测警报通过起程拓殖,主要监控我们继续监测: 
 HTTP错误主要从我们的负载平衡器。 
 在目标群体健康的实例。 
 SQS处理延迟。 
 监测是最好的工具来基于AWS-generated警报指标(比如从负载平衡器或自动定量组)。CloudWatch警报通常去PagerDuty,从PagerDuty松弛/手机。 
 DataDog是服务我们用来存储和处理时间序列指标。我们从Linux盒子发送指标,AWS资源,现成的服务(如NGINX或MongoDB),以及定制服务,我们建立了(像我们管理API)。 
 我们有很多DataDog监视器。几个例子: 
 响应时间增加服务环境美元。 
 空间不足的体积在美元实例上(ip_address美元)。 
 问题过程环境/美元美元主机(ip_address美元)。 
 处理时间的增加服务环境美元。 
 国家结核控制规划美元主机上漂流了/时钟问题(ip_address美元)。 
 MongoDB副本集合变化对美元的环境。 
 从上面的例子中,你可以看到我们有监控底层指标(如磁盘空间)和高级度量(如MongoDB副本集合变化,这提醒我们如果有一个主节点定义的变化,例如)。我们做得更多,一些相当复杂的监控在一些服务。 
 DataDog警报是相当灵活的输出,我们通常把他们都松弛,发送PagerDuty只有那些应该“叫醒人”(如峰值的错误,或大部分事情我们确信有影响客户)。 
 我们使用Kibana和SumoLogic日志;我们使用SumoLogic记录审计跟踪和许多AWS-generated日志,和我们使用Kibana存储应用程序日志从我们自己的服务和其他“现成的”服务,如NGINX和MongoDB。 
 我们的平台进化不少为了处理额外的负载和巨大的各种用例对我们的客户很重要,但我们仍有优化的空间。 
 不仅我们的平台的成长,但我们的工程组织增加大小:我们有很多新的团队构建自己的服务和自动化的需要,工具和指导可伸缩性。 
 考虑到这一点,这些举措 
 那个地方规模不仅我们的平台,而且我们的工程实践: 
 建立一个平台,PaaS风格:如前所述,今天我们有不同的自动化和部署流;这将导致混乱和创建一个对工程师的门槛很难实验和扩大没有接触太多的存储库。我们正在为一个平台开发PoC(ECS)上当前运行工程师可以配置一个YAML文件和部署计算资源,监控、日志、备份、等等。这一切无需显式配置它。这项工作仍在初期阶段,可能改变很多(的)。然而,我们感觉我们正在正确的方向上不断增长的规模和可伸缩性限制。 
 为每一个新的拉请求实现冒烟测试:除了单元测试(已经运行在每个新的公关),我们想在短暂的运行集成测试环境的地方,是可能的。 
 集中我们的日志解决方案提供者。这可能意味着远离SumoLogic Kibana和使用,但是我们仍然需要评估的特性集,数据量等等。 
 自动化指标:太多的度量故事现在手册:添加metrics-related调用代码,同时部署和构建仪表盘和显示器使用DataDog接口。如果我们使用一个标准的格式和命名,我们可以做诸如建筑仪表板/自动监控,从日志中提取指标而不是显式地添加调用代码,等等。 
 确保我们有伸缩和蓝色/绿色部署在每个核心服务。这应该开箱即用的来自我们的新平台,但是,正在建造和测试我们需要改善的比例/部署/回滚的故事在这方面仍然缺乏的核心服务。 
 全球领袖Auth0 Identity-as-a-Service(IDaaS),为成千上万的企业客户提供了一个通用的身份为他们的网络平台,移动物联网和内部应用程序。它的可扩展平台无缝地验证和保护超过1.5 b每月登录,使它爱由开发人员和受信任的全球性企业。公司的美国总部在贝尔维尤,佤邦,和额外的办公室在布宜诺斯艾利斯,伦敦,东京,悉尼,支持其客户位于70 +国家。 
 欲了解更多信息,请访问https://auth0.com或在Twitter上关注@auth0。 
  
  
 认证工作。任何设备应用。。托管的任何地方。 
  
  
  
   
  URL : https://auth0.com/blog/auth0-architecture-running-in-multiple-cloud-providers-and-regions/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website