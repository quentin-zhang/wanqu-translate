 
 07年8月, 
 2017年 
  
 在Weaveworks < br / >,我们织云SaaS开发人员负责操作。“GitOps”是我们的名字我们如何使用developer工具来驱动操作。这篇文章谈到GitOps,90%的最佳实践和10%的很酷的新东西,我们需要构建。公平的警告:这就是为我们工作,亲爱的读者,你可能会不同意。 
 < br / > Git是每个开发人员工具包的一部分。使用这篇文章中概述的实践,我们的开发人员通过Git Kubernetes运作。事实上,我们管理和监控所有的应用程序和使用GitOps整个“原生云栈”。感觉自然和学习不是那么吓人,工具本身是非常简单的。 
 < br / >在过去的两年里,我们一直在运行多个Kubernetes集群和普罗米修斯遥测数据库在Amazon Web服务。你可以阅读更多关于我们如何提供Kubernetes博客,”供应和生产准备Kubernetes集群的生命周期”。 
 < br / > GitOps究竟是什么?通过使用Git作为真理的来源,我们可以几乎所有操作。例如,版本控制、历史、同行评审,和回滚发生通过Git无需工具,像kubectl闲逛。 
 < br / > 
 < br / >假设一个新的团队成员部署一个新版本的服务推动没有告诉团队随叫随到。diff工具检测到什么不匹配运行配置(即运行。Git存储库中指定的图像不同于一个部署在生产)。火灾警报的diff工具。随叫随到工程师询问,决定改变的目的。  
 < br / > Kubernetes只是举了一个例子,许多现代工具“声明”。声明意味着配置是保证由一组事实而不是一组指令,例如,“有十复述,服务器”,而不是“十复述,服务器开始,告诉我它是否工作”。  
 < br / >通过使用声明性工具,整个组配置文件可以在Git版本控制。这意味着Git是真理的源泉。,这也意味着你得到代码审查,评论在配置文件中,并链接到任何问题提交消息和PRs。所有这些使得系统(和它背后的原因!)发现,更容易操作,恢复和观察。你甚至可以包括版本控制产品用户故事来帮助理解进化的目的以及实现。 
 < br / >在Kubernetes的案例中,我们使用版本控制不仅为代码还YAML文件定义Kubernetes部署,服务,DaemonSets,等等。我们也使用起程拓殖和Ansible条款Kubernetes亚马逊,这些都是还在Git版本控制。  
 < br / >声明配置工具很酷;他们让你描述你想要在Git中真实状况。但他们遭遇的问题,“现在真的是活动的系统,并可能不同于源代码控制中描述的是什么。我们如何知道当生活系统聚合所需的状态吗?我们如何得到通知当这种不同?什么是“煤矿里的金丝雀”,可以告诉我们,当我们陷入困境?我们如何触发收敛呢? 
 < br / >这里先前技术。  
 < br / >工具如厨师,木偶和Ansible支持功能,如“diff警报”。这些帮助运营商了解可能需要采取行动,“收敛”现场系统到目标状态(如定义的配置脚本)。而最近,最佳实践是不变的图像(例如部署。容器),散度不太可能。 
 < br / >在“GitOps”模型中,我们使用Git来解发散和收敛,得到一组“diff”和“同步”工具,比较计划和实际状态。一个完整的写在这里。 
 < br / >在这一节中,我将谈论Weaveworks工具。这是一个介绍,更多的将会在第二个帖子 
 的话题。 
 我们产品< br / >织云提供了工具使用GitOps云本机应用程序模式。我们GitOps机械是蔡先生的核心工具。对我们来说,关键是持续部署(CD)和发布管理。这是基于我们的开源项目编织通量支持Git-cluster同步,所以是专为版本控制系统和声明应用程序堆栈。 
 < br / >此外,我们有3个主要的diff工具:kubediff ansiblediff,terradiff。每一个比较最新Git在部署环境中运行。因此,我们在开发集群运行这些工具Git和开发之间的差异,和我们推动集群Git和刺激之间的差异。有普罗米修斯指标有差异。这个度量触发一个警告,如果有差异超过1 h(或类似的东西)。 
 例如:< br / > 
 < br / > kubediff之间的差异是一个命令行工具,显示你的运行配置和版本控制配置。如果是有区别的,它返回一个非零退出代码。从“监视与普罗米修斯Kubernetes基础设施”() 
 < br / >为什么这件事?没有这样的东西,特别的细微变化会逐渐建立,你可以不再区分系统应该如何以及它如何是你不知道是故意的,什么是偶然的。这也意味着,无论在Git存储库将成为过时的不可救药。 
 < br / >示例用例:一个工程师更改国旗dev测试一个新的变化,可能会提高性能。他们做实验,收集结果,但是后来忘了重置国旗。幸运的是,弹出一个警告在松弛30分钟后提醒他们清理自己。 
 < br / >让我们回顾——用例是,我们提供一个完整的云本地堆栈包括Kubernetes。作为在这种情况下的帐面价值: 
 < br / >这里给出的系统允许将为整个系统的状态存储在版本控制,该状态的检查和执行三个工作:terradiff,ansiblediff kubediff。集群的所有配置文件版本控制,和修改任何组件可以推出零停机时间和回滚容易如果他们破坏任何东西。我们开始住谷歌的行为说的“改变赛车的轮胎的100英里”。 
 < br / >让我告诉你一个故事关于GitOps方法帮助我们。 
 < br / >的场景:2016年的春天,一个和平的早晨在伦敦。阳光灿烂。鸟tweet。 
 < br / >“我要做出改变,可能会消灭我们所有的系统” 
 < br / > "汤姆,你确定我们要这样做?” 
 < br / > <点击> 
 < br / >“噢——我刚刚删除我们所有AWS Kubernetes集群” 
 < br / >混乱随之而来 
 从总系统< br / >复苏失败不同于固定每天的失败。接下来发生了什么?团队花了不到45分钟完全重建我们的整个系统。这包括设置多个AWS服务:EC2 ami,埃尔勃斯,SQS,DynamoDB,等等,我们所有Kubernetes集群和应用程序,和我们整个可观测性堆栈。45分钟是一个很好的结果——通过“GitOps”。(阅读我们如何运行Kubernetes AWS和你需要知道的)< br / >我们的失败故事展示了如何重要的是优化平均恢复时间(MTTR)。这也会导致客户快乐。如果我可以引用布莱恩•哈特菲尔德在Twitter上引导慈善专业良好操作规范导致“紧迭代时间和高价值客户”。 
 < br / >让我们总结。 
 在Weaveworks < br / >,我们的使命是让开发人员做操作。  
 < br / > Git已经状态的艺术向前发展。十年的最佳实践说配置代码,和代码应该存储在版本控制系统中。现在是支付 
 nefit行动。在Weaveworks现在我们发现我们宁愿通过拉请求解决生产问题,更改运行的系统。 
 < br / >,除非它就没有这样的问题使您的应用程序集群更容易理解和使用。GitOps实践取得了Kubernetes和云本机应用程序更加容易。我们真的认为你会发现这也。工具本身是非常简单的。我们烤成产品,织云。  
 < br / >演示任何时间联系我们,或者只是签约。 
 < br / >在以后的博客文章,我将尝试设置的列表GitOps原则和“如何GitOps”。这将包括信息如何使用容器、CD管道(GitOps管道-第2部分),和一个版本控制可观测性堆栈。我还将讨论更多关于GitOps是现有方法的迭代:DevOps,“基础设施代码”,等等。看这个空间。 
 < br / >——亚历克西斯< br / >亚历克西斯Weaveworks的联合创始人兼首席执行官。他也是CNCF TOC,主席和创始人之一的女生:代码聚会。先前他在关键的,春天,产品主管,复述,Apache Tomcat和vFabric RabbitMQ。亚历克西斯负责重置春天和过渡的产品方向从VMware vFabric业务。亚历克西斯共同RabbitMQ,兔子被VMware收购公司的首席执行官在2010年,他曾在众多的云平台。传言称他与其他软件公司包括粘性网络,后从事自营交易员在固定收益衍生品和浪费青年学习和教学的数学逻辑。以前< br / > < < br / >我缓慢的互联网和码头工人< br / > Next > < br / >以用户为中心提醒< br / > 2014 - 2018 Weaveworks < br / > 
  
 URL : https://www.weave.works/blog/gitops-operations-by-pull-request?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website