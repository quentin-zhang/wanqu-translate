不管你有什么样的应用程序,您需要获取一些数据,显示给用户,让用户交互和更新它。 
 这种交互和更新阶段通常是异步的天性,从后端应用程序等待响应是否更新数据。更新通常是基于行动的成功引发了用户。 
 乐观的用户界面是当用户触发一个动作和UI立即更新,尽管可能会有等待的请求。 
 当我们的应用程序是使用这种UI构建的,我们可以马上更新UI的成功案例。在失败的情况下,UI将恢复到原始状态。 
 在用户的眼睛,这个UI让我们更加流畅和响应性经验。使用时谨慎、乐观UI更新可以给我们的程序更完善和更具响应性的字段没有复杂性。 
 Twitter是一个很好的例子,乐观的UI。让我们看一个底层的Twitter和看到乐观的界面是如何实现的。 
 让我们看看Twitter。头到Twitter和打开任何tweet。同时,打开你的浏览器的DevTools和开放网络选项卡。 
 使用过滤字段只看看后最喜欢的请求。POST最爱请求触发当用户单击图标。 
 当你点击图标,您将看到在创建。json请求被触发。请求解决的非常快,我们不能完全看到正在发生的事情后,用户点击图标。让我们慢下来通过点击在线按钮,然后选择缓慢的3 g网络。 
 当你再次点击心脏按钮,我们可以看到,尽管请求等待,心在视觉上更新。一旦请求已经完成,只有这样的“喜欢”增加或减少。 
 如果我们完全禁用网络(点击“离线”按钮在DevTools),我们可以看到,心脏图标将视觉更新,然后回复到初始状态由于网络故障。 
 那么我们如何使我们的UI立即更新,以反映用户操作,而不是传统的等待后端成功的反应? 
 在这篇文章中,我将展示如何实现这种类型的用户界面反应在你的应用程序通过构建一个Twitter等按钮。我也分享这个组件使用,所以它可以,玩任何项目的使用。 
 我将twitter上面的示例向您展示如何做到这一点。但首先,让我们设置一个简单的应用程序,其中包含一组微博反应。 
 首先,创建一个新的项目使用create-react-app反应 
 在代码编辑器中打开项目目录。我个人喜欢用VS代码。删除所有的文件除了App.js和index.js在src文件夹。 
 让我们首先定义tweet。创建一个新文件名为Tweet.js在src文件夹。内部,编写下面的代码: 
 在前进之前,我们将添加一些更多的事情我们的应用程序。让我们打开索引。html文件从公共文件夹。在标题标签,添加以下: 
 接下来,我们需要创建一些内容显示。App.js文件在src文件夹,删除之前的样板代码和写这个: 
 通常,当我们点击❤️图标,将立即发生的事情。但是通过把这个方法到异步调用,我们可以考虑失败的请求和恢复状态。 
 让我们实现这个应用。在上面的代码片段中,我们设定等于initialstate状态。让我们首先定义上面的应用程序组件。 
 在这里,我们有一个数组,其中包含两个tweet。这个数组实际上是一个对象数组和一个ID、一个数字代表的数量每推特喜欢。国家还包含用户名和微博内容。我们通过它和显示tweet映射。 
 接下来,我们需要定义请求应用程序很快就会回来的 
 l发送后,用户点击图标。App.js文件,编写一个新功能叫做likeTweetRequest如下所示: 
 我希望我的第二次推特就像请求失败。要做到这一点,只需添加下面这条直线导入语句: 
 在微博/ >组件,调用likeTweetRequest函数如下: 
 现在,运行纱线开始或npm开始命令打开应用程序。如果你看看DevTool的控制台,您将看到请求函数是成功和失败。 
 正如您所看到的,即使请求被触发,完成,我们的UI仍然没有相应更新。 
 这里,我们将使用设置状态函数来更新组件状态基于之前的状态,在微博的“喜欢”状态切换。同时,我们还将递增和递减tweet的喜欢属性和添加/删除的tweetId likedTweets数组。 
 看一下<推/ >在App.js文件中。这里,tweetId onClickLike接受,我们将连锁的成功和失败案例推特就像函数。 
 在<推/ >组件,取代先前onClickLike语句: 
 我们现在需要定义onClickLike函数。略高于render()函数,编写下面的代码: 
 这里发生了什么?我们使用的是这个。设置状态更新我们之前的状态。 
 设置状态函数会接受另一个函数,我们需要做的第一件事就是确定目标微博已经喜欢了。这是通过的likedTweets看看我们之前的状态。 
 现在我们可以看看,包括我们的目标。一旦我们知道,应用程序可以返回新的更新状态。现在,我只是更新喜欢推数组。 
 如果目标微博已经喜欢,点击图标应该与它。这是通过使用过滤器函数。使用过滤器,我们将只保留那些tweet的id不等于目标tweet的id。 
 如果推特不是已经喜欢,我们将追加likedTweets tweet的数组。 
 现在唯一剩下要做递增/递减tweet的喜欢。我们更新推特的基于当前微博的state.tweets数组。 
 我们将使用map函数在每个tweet并检查是否他们已经喜欢。 
 如果推特已经喜欢,喜欢属性将递减。如果不喜欢,那么喜欢属性将增加一个。 
 如果map函数的微博目前看不是目标tweet,然后它需要返回。 
 而内联设置状态函数,我们可以把它写成一个更新函数。 
 让我们给它一个描述性的名称,就像setTweetLiked。这个函数会接受tweetId newLiked。函数就会返回我们在设置状态,而是查找当前状态,我们将看newLiked tweet。 
 我们把newLiked tweet,问如果推特已经喜欢与否,并相应地执行流程的其余部分。 
 街道之上的应用程序组件,写下下面的代码: 
 现在来填补这个内部应用程序组件,我们可以调用它里面onClickLike这样的。它需要tweetId和newLiked作为参数。这将是相反的当前的喜欢。 
 现在,当我们点击心脏,我们可以看到,数量和心脏是适当地更新。 
 我们还没有处理失败案例。让我们照顾。 
 目前,我们可以切换心脏和盈亏喜欢的数量。我们更新我们的国家是我们假定请求成功,但尚未处理请求失败。 
 在请求失败的事件,我们必须恢复国家我们已经更新,因为我们认为成功的用户交互。 
 立刻点击图标,我们调用 
 设置状态使用我们设置状态更新器工厂,接受tweetId和newLiked地位。而不是这个isLiked切换状态,我们可以使用的状态时它被点击。 
 看看likeTweetRequest函数onClickLike内部函数。更新它的捕获函数如下所示的代码。 
 现在如果我们点击这个失败的案例中,我们将看到它更新,当时它失败,返回到原始状态。 
 现在我们可以点击,并立即更新UI。之后,如果请求被拒绝,UI将恢复到原来的状态。 
 但是还有一个问题留给照顾。如果你radiply单击心脏图标两次,你会看到这样的事情发生。 
 这里发生的事情是,当我们快速点击心脏图标两次,两个请求被发送到后端。两个请求将失败,用户会觉得微博是成功地喜欢。 
 有一个简单的解决方案。我们可以在我们的应用程序称为likeRequestPending添加一个实例属性。让我们将它设置为false。 
 所以后立即点击,应用程序需要检查likeRequestPending的价值。如果这个标志的值是正确的,那么这个应用程序将发送一个空的回报,这基本上意味着应用程序将什么也不做直到likeRequestPending变成假的。 
 一旦请求完成(成功或失败),然后likeRequestPending改变的价值回到这样的错误: 
 这样,我们已经解决了双重更新的问题。 
 你可以看一看整个源代码和组件: 
 感谢你的阅读!如果你喜欢这个post,请?和respond.跟我在Twitter上保持与其他反应文章更新。 
 信号通过鼓掌或多或少,您可以对我们的故事真的脱颖而出。 
 时代的编码代码组件 
  
   
  URL : https://blog.bitsrc.io/building-an-optimistic-user-interface-in-react-b943656e75e3?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website