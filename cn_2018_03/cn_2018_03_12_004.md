 
 博士(tl,看到我的视频演示/本文的演示)) 
  
  
 维护服务器分为两个阶段: 
  
  
 最近,我一直在玩的第一阶段 
 第二。因为没有更好的词,我称之为文学 
 devops。 
  
  
 我谈到了使用org-mode识字的编程模型 
 调查新想法和结晶的想法,这种方法 
 似乎适合我因为我缺乏那些深奥的系统管理员 
 技能。 
  
  
 从前,我是负责修补一个RPM,不在 
 我的舒适区,所以我最初的进攻计划是: 
  
  
 当然,一旦我找到解决方案,我需要记录它 
 别人对我的团队,或许创建一个repeatedable脚本。 
  
  
 第一步是有据可查的,但是今天我学会了(直到) 
 你可以直接ssh Vagrant-based虚拟机 
 这个小魔术(注:客户是我虚拟的名字 
 机我Vagrantfile中指定): 
  
  
 这个命令附加一些可爱的魔法主机连接,这样你就可以 
 问题:ssh clientvm 
  
  
 而不是打开一个终端虚拟机,我流行 
 Emacs和加载这个sprint的注意file1,创建一个新的头, 
 和进入壳牌和ruby命令在这个文本文件。 
  
  
 这是什么好?与传统终端,这让我 
 日志、文档和执行每个命令。 
  
  
 例如,这是一个部分的截图我的Emacs缓冲区: 
  
  
  
  
 作为一个老熊很少的大脑,我的散文可以解释 
 每个命令的背景和目的。点击超链接 
 以前发现的刷新我的记忆。keychord执行 
 代码块… 
  
  
 是的。我在Emacs中执行命令。 
  
  
 达到碳碳碳碳(control - c两次)(基于运行代码 
 语言)。这个例子在shell中运行。结果被放置 
 回文件,该文件可以使用其他代码块(和许多 
 其他选项)。 
  
  
 例如,这是上半年部分下载 
 GPG密钥存储库(URL是放置在一个属性 
 在所有共享的代码块在他的部分): 
  
  
  
  
 Shell脚本块(截图)的中心使用 
 wget下载HTML索引文件和解析和提取的关键 
 文件的url。我们将有一个Ruby脚本解析,并自 
 脚本可能有点麻烦,我们将定义在另一个代码块。 
  
  
 一项技术从文学编程是一个代码 
 块可以被插入到另一个块(引用是一个名字 
 在双尖括号< <…> >)。Donald Knuth称这 
 网络功能。因为它可以意外与一些语言冲突 
 (像Ruby),我已经默认了,但是打开这个块 
 noweb参数。 
  
  
 这是Ruby脚本。它在一个单独的ruby具体代码 
 块让我打开的所有Ruby魔法Emacs。 
  
  
  
  
 最后一步是由第一个脚本url 
 给他们另一个Shell脚本将调用wget下载 
 每一个: 
  
  
  
  
 密钥表是我们最初的代码块的名称,以及 
 其结果的名称。我们分配,结果列表 
 变量,美元的shell脚本将访问列表。 
  
  
 这个例子演示了如何文学编程可以编代码 
 和数据通过不同的语言。 
  
  
 通常情况下,指定sh代码块的语言,告诉 
 Emacs运行代码在我的本地系统的外壳,但在这种情况下, 
 我希望它在我的虚拟机(或开发服务器 
 我的实验室)。这样做,我将描述两个选择:使用流浪汉 
 巴别塔。 
  
  
 流浪汉是一个Emacs的特性,允许一个编辑一个文件 
 远程计算机使用ssh和其他协议。例如, 
 查找文件函数运行(绑定到cx氟)让你的类型 
 喜欢的东西: 
  
  
 如果你把以下. emacs初始化文件中: 
  
  
 和 
 更新你的~ /。ssh / config文件了解用户帐户 
 主机名,可以缩短上述文件参考: 
  
  
 Emacs查找:字符来确定流浪汉 
 调用。不定期使用SSH密钥,如果可用,或将提示您 
 如果需要一个密码。 
  
  
 每个org-mode代码块可以指定:dir选项,用来指定 
 应该运行的代码片段,例如,下面的吗 
 块是等价的: 
  
  
  
  
 :dir选项允许完整的流浪汉功能,允许我去 
 不同的机器上运行一个街区。还记得我说 
 客户的流浪汉~ /虚拟机。ssh /配置文件? 
  
  
  
  
 但是我需要访问机器在防火墙后面! ? 
  
  
 我的工作处理虚拟机运行在一个高度保护 
 数据中心,我首先需要登录框和堡垒 
 机器。不定期处理这些啤酒花。例如: 
  
  
 使用我的账户名登录堡垒机,和 
 然后使用我的帐户名称向虚拟机运行ssh 
 在一个私有云。然后使用sudo命令我来编辑 
 一个文件由根。 
  
  
 流浪汉管参考使用:org-mode dir选择 
 来源: 
  
  
  
  
 记住一些技巧: 
  
  
 另一种方法是创建一个会话连接不同 
 代码块在一起。下面的屏幕截图,每个下面的代码块 
 会话值相同,客户(这是方便的 
 同样我的虚拟机的主机名、客户): 
  
  
  
  
 如果我执行第一个块,始于一个shell 
 背景,ssh到机器。注意,这个 
 工作,您需要启用无密码访问通过将您的 
 SSH的公钥到远程系统的. SSH / authorized_keys 
 文件,或者使用ssh Emacs package.3 
  
  
 从这一点上,每个代码块我和客户端执行 
 会话值,使用这个连接,上执行的代码 
 远程计算机(虚拟机在这种情况下,但这并不 
 )。 
  
  
 这两种方法是有效的,但是第二种方法, 
 让我创建一个特定状态,设置变量 
 块可以期待。然而,这需要执行的每一块 
 秩序。 
  
  
 我有一个第三,更多的互动,approach4使用屏幕,但是 
 它不允许传递变量的代码,你会看到 
 下面,这对我来说是非常重要的。 
  
  
 无论如何,我将继续学习如何实现我的目标,所有的 
 当我记录和验证步骤。最终的结果 
 出口到web或wiki页面。 
  
  
 是的,可以相当耗时,执行一些命令 
 冗长,但通常我需要搜索结果,和拥有 
 放置在一个Emacs缓冲允许更好的搜索结果。 
  
  
 我经常使用一个可折叠的“抽屉”(也就是识别的一种方法 
 输出的开始和结束): 
  
  
  
  
 将光标放在这个抽屉里,隐藏或按Tab键 
 显示输出: 
  
  
  
  
 一些命令的结果往往需要下一个命令, 
 我相信你喜欢用你的鼠标复制粘贴的部分 
 的输出,但我有一个更好的方法。 
  
  
 例如,我需要一个RPM的依赖关系列表: 
  
  
  
  
 注意我任命这个代码块来源。也注意到Emacs 
 成一个表自动打破了结果。默认情况下, 
 shell命令的输出换行和分裂 
 空间。 
  
  
 我可以喂这些执行的结果到另一个代码块。 
 下列源块创建一个名为决定的变量 
 使用2到10行第一列的数组。 
  
  
  
  
 然后我下载rpm我希望没有任何鼠标交互。 
  
  
 重用的一个关键方面devops程序(像一个厨师 
 食谱)是分离的代码的代码值 
 使用…你重用任何程序的一个关键方面。 
  
  
 在我的世界里,我创建了一个新的org-mode文件每个sprint 
 每个都有自己的头一个任务或问题 
 nd部分。每个部分 
 可以有一个抽屉的属性,包括变量之间共享 
 所有在这部分代码块。 
  
  
 要创建一个部分变量,只需达到:碳碳cx p,和设置 
 var属性和值给一个变量=值,如: 
  
  
 这个抽屉里可以包含任何你希望代码块值, 
 会话或结果。这些值可以被覆盖 
 设置的代码块,你看这个截图: 
  
  
  
  
 设置变量和设置(特别是会话设置), 
 代码块在一起的关系。 
  
  
 调查在操作和管理部门(如我 
 描述)是有用的对自己理解问题 
 域,我需要和我的队友沟通结果。 
 自从我Emacs配置允许我发送邮件,我踢 
 的函数,org-mime-org-buffer-htmlize,出口 
 org-mode文件到一个HTML邮件消息(这个函数的一部分 
 最新的org-plus-contrib包)。 
  
  
 然而,一些次导出的结果不是很完美。 
  
  
 例如,一些可能会导致一些JSON数据块, 
 HTML输出可以语法,如果我可以指定 
 输出结果是JavaScript,那么JSON数据 
 要漂亮得多。只使用包装参数,如: 
  
  
 将在我org-mode以下文件: 
  
  
 获得出口: 
  
  
 另一个例子,我目前的项目包括与OpenStack合作, 
 和它的新星命令行实用程序尝试格式化数据 
 表: 
  
  
 如果你手动改变输出,这些变化不会尊敬 
 导出文件时(因为这些期间重做 
 出口流程)。 
  
  
 的方法就是你小Emacs Lisp代码块 
 只需要在您的文件,如: 
  
  
 这个代码块叫做nova-conv,我可以使用它 
 后处理结果,如: 
  
  
 在特定的情况下,我也想摆脱的第一行 
 破折号更org-mode: 
  
  
 真正可重用,这段代码在你的巴别塔图书馆, 
 然后它可以从任何文件。 
  
  
 虽然我的文学devops方法不应该取代真正的devops 
 自动化(OpsDev ?),我发现这种方法有用的两个 
 原因: 
  
  
 对于最后一点,我经常写文学中的文件 
 过去时态,之前我写和执行代码,如: 
  
  
 然后,如果我下面的命令或过程失败,我可以 
 高亮的部分我的文档,点击cx电子邮件了 
 HTML版本出口到团队的其他成员(否则,我 
 花几个小时复制/粘贴从终端提供 
 足够的上下文的邮件)。 
  
  
 需要一个完整的示例吗?看看我的笔记设置IP表 
 (和原org-mode文件),文件的一部分 
 在编辑器中执行为了看看我的机器 
 配置,另一部分是一个脚本,该脚本可以纠缠 
 机和执行重置防火墙规则。 
  
  
 感谢你的阅读。 
  
  
 对于每个新的冲刺,我创建了一个org-mode格式化文件 
 跟踪任务,指出,和其他细节。这使它适合 
 嵌入文化devops。 
  
  
 在不同的每个操作系统创建临时文件 
 目录的位置。大多数Unix系统,使用/ tmp /,但mac电脑使用 
 /var/folders/.当前org-mode代码使用相同的目录中 
 远程系统上的名字在本地系统上的工作。在我 
 工作情况下,我使用我的Mac笔记本电脑连接到Linux系统 
 我和我的数据中心,得到以下错误: 
  
  
 错误在org-mode版本8.2.10早些时候(可能),就像我 
 发现在这个邮件列表发布(这可能不是固定的 
 虽然因为它并不真正清楚最好的解决方案)。来 
 修复它自己,编辑ob-core。org-babel-temp-file el文件 
 函数是: 
  
  
 如果你安装ssh。el项目,你会初始化 
 请愿连接 
 你的远程系统使用:m x ssh 
  
  
 你会输入主机连接信息,包括 
 密码(如果需要)等。例如,如果我与主持人: 
 goblin.howardism.org,然后我的代码块会引用 
 会话是这样的: 
  
  
 这是让你看你的代码在远程系统上执行, 
 但仍允许一个全功能的代码块,可以读值 
 其他地区的org-mode文件。 
  
  
 注意:会话参数的值是*包围 
 字符(缓冲名称)的一部分,但你的变量 
 想通过在引号(否则,他们包围 
 解释为命名的引用表中的其他文档)。 
  
  
 我有一个执行远程命令的第三条道路,这使用 
 ob-screen扩展(位于org-mode Contrib 
 收集)。它使用Gnu屏幕和xterm,我也在我的Mac, 
 开始XQuartz(内置的X Windows模拟器),并添加了 
 之后我. emacs初始化(基于这些指令) 
 设置我的xterm程序的完整路径: 
  
  
 我不经常使用屏幕,但我使用自制程序安装: 
  
  
 然后告诉ob-screen如何找到它: 
  
  
 现在的代码块指定为屏幕,我通常指定 
 使用哪一个xterm窗口通过设置:会话参数: 
  
  
 结果不要放在我的Emacs文件缓冲区,但 
 简单地离开,在xterm窗口,。 
  
  
 使用屏幕其他不好的一面是它不通过 
 变量。例如,以下是行不通的: 
  
  
 xterm窗口中看到来回的结果不错,但是 
 不能带来进一步的结果返回到文件 
 处理是有限的。同时,你必须抵制诱惑来解决 
 在xterm窗口中输入命令。如果你沿着这条路,你 
 可能忘记把信息回org-mode文件,然后呢 
 很可能会后悔。 
  
  
   
  URL : http://howardism.org/Technical/Emacs/literate-devops.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website