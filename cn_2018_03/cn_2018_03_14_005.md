基督教米兰达|软件工程师,成长 
 超过一半的每月2亿活跃用户Pinterest使用我们的应用程序在美国以外我们继续让Pinterest更好的为我们的全球用户,我们移动交通国家代码顶级域名(国家)。这方面的一个例子为德国的网站www.pinterest.de而不是www.pinterest.com。这里我们将深入探究细节的这种变化如何可以帮助改善增长和讨论一些我们在整个过程中遇到的工程挑战。 
 Pinterest》于2010年生效以来,每一页的网站托管在www.pinterest.com。几年下来,我们介绍了国家子域(例如de.pinterest.com)为了段内容由国家和为平纳提供了更加本地化和相关经验。这个改进搜索引擎优化(SEO)和一般的增长,因为更多的人发现相关内容在他们语言国家子域在全球搜索结果排名更高。 
 下一个步骤是实现国家。通过研究我们了解到一些其他网站的开关看到中性或负面影响增长,尽管该行业对国家的看法是,他们提供了一个更强大的地理定位信号在许多搜索引擎算法,和用户更有可能点击结果与当地域名后缀的(这可能会导致更高的点击率,从而积极影响搜索排名)。我们想对他们进行测试,看看他们会为Pinterest和多样化的工作目录的内容。 
 表面上看,这个项目看起来相当简单——所有我们要做的就是提供新的国家我们希望和开始给他们设置重定向流量。然而,很明显,改变我们的网站的顶级域名需要重大改变我们的基础设施。 
 Pinterest身份验证是非常标准的。我们有一个内部用户服务,处理与用户名/密码组合签订ups,我们使用OAuth开放标准对于那些与第三方进行身份验证(例如Facebook)。我们检索后端返回一个访问令牌验证用户每次访问www.pinterest.com。 
 随着国家的引入,我们需要支持的能力验证用户不管他们访问的域名。我们的解决方案是建立一个中央域(accounts.pinterest.com)将作为所有登录的真理的单一来源。 
 简而言之,Pinterest国家沟通与中央域来确定身份验证状态和设置客户端饼干镜。在下一节中详细描述了这种通信,我们称之为auth握手。 
 auth握手的一般流程是: 
 有一个问题在于第一步:同源策略指出,“web页面上的脚本只能访问另一个web页面的数据如果两页有相同的起源。”这是网络安全的支柱,这是防止恶意网站上的Javascript访问个人或敏感信息。auth握手的情况下,阻止Pinterest国家与accounts.pinterest.com由于不匹配域(例如pinterest.com和pinterest.abc)。 
 通过这个工作,我们用跨源资源共享(歌珥),使web服务器跨域访问控制实现跨域安全的数据传输。这是通过添加新的CORS-specific头HTTP请求和响应的数据传输,并相应地处理。 
 让我们走过这个过程的简化示例Pinterest在www.pinterest.de上注册使用身份验证握手。首先,客户端指定它想做一个跨域请求到accounts.pinterest.com用户的凭证。此时,浏览器自动添加一个起源头请求,指定当前域。 
 当请求 
 到达服务器,我们创建一个访问令牌和验证用户在accounts.pinterest.com上。一旦用户登录,握手发回响应给客户端自定义的令牌。这个令牌可以用来交换一个访问令牌,www.pinterest.de可以用来进行身份验证。 
 服务器跟踪所有的国家我们白名单进行身份验证。在我们返回响应之前,我们检查的价值原点请求头存在于白名单中。如果是这样的话,服务器将特别歌珥头添加到响应。其中最重要的头部Access-Control-Allow-Origin;这个头的存在信号到客户端是否允许跨域传输。 
 当客户端接收到响应时,它将Access-Control-Allow-Origin头值“https://www.pinterest.de”。因为这匹配客户的起源,它继续处理响应。自定义令牌是检索和用于获取一个访问令牌,允许用户登录www.pinterest.de。 
 你可以阅读更多关于跨源资源共享和全套的头参与这些请求官方Mozilla文档。 
 一旦我们建立新的本地域名,下一步是帮助他们变得更可发现。最简单的方法之一,引导交通是实现新域名重定向。当适用时,我们使用永久(301年)重定向从旧现有国家子域相关联的新国家(例如de.pinterest.com→www.pinterest.de)。使用永久重定向允许我们将大部分的网页排名和权威的页面在旧域新的。 
 也有一些间接的方法用来改善交通质量的新国家。hreflang属性可以包含在一个web页面的标记告诉搜索引擎爬虫的不同语言版本。当搜索引擎看到这个标记,他们表面局部相关页面根据搜索者的语言环境。我们还使用文件叫做站点地图,帮助提高效率和速率搜索引擎抓取我们的网站。站点地图文件用于列出你的网站的网页,告诉搜索引擎的组织你的内容。通过提供这些文件直接搜索机器人,它是容易找到新的内容和等级。 
 到目前为止,我们已经观察到积极的交通增长和增加点击浏览我们的国家。通过这一过程的一个更有趣的发现是,更多的页面可以被索引,因为不同的顶级域名打开一个单独的搜索机器人“爬行预算”。 
 前进,我们将继续投资于国家对我们的国际内容和正在调查进一步提高accounts.pinterest.com作为中央认证中心所有Pinterest属性。 
 确认:Devin Lundberg,乔什·恩德斯,山姆地中海,杰斯,埃文·琼斯,杰夫•艾弗里灰色Skold教授,朱莉特里尔,瓦迪姆安东诺夫,Kynan Lalone,伊芙琳Obamos &国际团队 
 信号通过鼓掌或多或少,您可以对我们的故事真的脱颖而出。 
 创新工程师建造的第一视觉发现引擎,1000亿的想法和计数。https://careers.pinterest.com/careers/engineering 
  
   
  URL : https://medium.com/@Pinterest_Engineering/how-switching-our-domain-structure-unlocked-international-growth-e00c8184d5dd?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website