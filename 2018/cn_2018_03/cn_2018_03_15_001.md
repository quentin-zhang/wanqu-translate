 
 新鲜hold-my-beer部门,我们为什么不建立自己的小CDN吗?哦,它有实际意义。 
  
 你可以从这个网站(希望)看到,我喜欢我的页面。非常非常快。现在,在我们进入这个,让 
 我非常清楚:使用CDN只会让你到目前为止。如果你的网站是缓慢的,因为劣质的前端工作, 
 一个CDN不会帮助你。首先你需要前端工作。然而,一旦你优化 
 一切都可以,是时候看看内容交付。 
 我的主要问题是,尽管你可以下去,网站的负载一个HTTP请求,我的服务器 
 在法兰克福举行,来自澳大利亚的人们仍然不得不等上2 - 3秒。往返的时代结束了 
 300 ms和很多供应商中间画了页面加载就像任何其他的Wordpress网站。 
 所以我们能做些什么呢?当然,一个解决方案是使用传统的CDN。然而,大多数商业 
 cdn把数据从服务器上请求然后缓存它一段时间。 
  
 使用传统的CDN初始页面加载慢于没有它,因为CDN是一个轻微的绕道 
 内容。这并不是一个问题,如果你有一个高流量的网站,因为内容停留在缓存中。如果 
 另一方面,您正在运行一个小博客像我一样缓存的内容从几乎所有的时间。所以, 
 实际上,传统pull-CDN将使这个网站慢。当然,我可以使用一个push-CDN我可以上传的地方 
 直接的内容,但这些似乎相当昂贵的相比我要建造什么。 
 我们的计划很明确:我们统治世界的道路,我们需要让我们的内容都快。这意味着 
 我们的内容需要接近观众。方便,有很多的云提供商提供便宜 
 虚拟服务器在多个地区。我们可以把我们的内容,比如6服务器和我们很好,对吧? 
 哦,不是那么快。是用户如何被路由到正确的服务器吗?让我们来看看实际的过程 
 得到一个网站。首先,用户浏览器使用域名系统(DNS)来查找网站的IP地址。 
 一旦它的IP地址,它可以连接网站并下载请求的页面。 
  
 如果我们考虑一个高水平,解决方案很简单:我们需要一个智能DNS服务器GeoIP 
 查找请求的IP地址并返回最接近它的IP地址。事实上,这是(几乎)商业 
 发布商。有更多的工程,如测量延迟,但这基本上是如何做到的。 
 下一个问题是:我们如何让DNS服务器快?让网站下载去最近的节点 
 只是工作的一半,如果DNS查询必须在全球各地,这仍然是一个巨大的滞后。 
 事实证明,基础设施支撑互联网是唯一合适的来解决这个问题。网络 
 提供者使用网络的边界网关协议告诉对方他们可以达到多少跳走了 
 他们是。最终用户ISP,在大多数情况下,需要最短的路线到达目的地。 
 如果我们现在做广告的IP地址在多个位置,总是会DNS请求路由到最接近的节点。 
 这就是所谓的边界网关协议Anycast。 
 等等,等等,如果我们能够这样做,我们为什么不简单地使用边界网关协议路由网络流量吗?有三个原因。 
 首先,做边界网关协议Anycast需要对网络的控制 
 硬件和至少256个IP地址池, 
 这是在我们的预算。 
 第二,边界网关协议路线并不稳定。DNS请求时只需要一个要发送的数据包在两个方向, 
 HTTP(web)需要建立连接请求下载的内容。如果更改或连接的路线 
 不稳定,HTTP连接可以打破。增加了很多的复杂性,这种规模的项目。 
 最后,计算最低的啤酒花,边界网关协议路由计算的基础,并不能保证最低的 
 旅行时间。整个海洋可能只是跳一跳,但这是一个该死的长。 
 进一步阅读:Linkedin工程 
 关于这一主题的精彩博文。 
 因为我们已经建立了我们不能运行自己的边界网关协议Anycast,这意味着我们不也可以运行自己的DNS服务器。所以 
 让我们去购物吧!…好吧,事实证明,DNS提供商提供边界网关协议Anycast服务器和latency-based路由 
 有点困难。在我的搜索,我发现只有两个,而昂贵的动力学和 
 亚马逊Route53非常便宜的。(更新:事实证明,DNS容易 
 也latency-based路由)。 
 因为我们很便宜,Route53。我们添加域,然后开始建立我们的机器的ip。我们需要尽可能多的 
 DNS记录我们全球服务器(边缘位置),和每个记录应该如下: 
 提示:它有助于建立一个健康检查每个边缘的位置所以他们如果他们去删除。 
 下一期我们需要解决分发内容。你的每个边缘节点需要有相同的内容。如果你 
 使用一个静态网站生成器哲基尔一样,你的任务很简单:简单地复制生成的 
 在所有服务器上的HTML文件。像rsync一样简单的事情可能会奏效。 
 如果你想使用一个内容编辑系统像Wordpress,你有明显困难的工作,因为它不是建造 
 CDN上运行。这是可以做到的,但它并不是没有缺点, 
 分布的静态内容仍然是一个问题。你可能要创建一个完全的分布式对象存储 
 工作。 
 接下来的一点是使用SSL / TLS证书。实际上,我们叫他们:x509证书。每个人 
 你的边缘位置为你的领域需要有一个有效的证书。简单的解决方案,当然,是使用 
 LetsEncrypt生成不同的证书,但是你必须要小心。勒了 
 一个速率限制,我遇到了我的一个边缘节点。事实上,我不得不把伦敦节点暂时下降 
 直到每周限制到期。 
 然而,我使用Traefik作为代理的选择,支持使用分布式键值 
 商店或甚至Apache管理员的后台同步。而这需要 
 更多的工程,它可能是更多的长期稳定。 
 真相,我的CDN如何执行?使用这个工具, 
 让我们看看一些全球统计: 
 正如您可以看到的,结果是相当不错的。我可能需要两个节点,一个在亚洲,一个在南美洲 
 更好的加载时间。 
 更新:之后,我来到了黑客新闻头版(哇!),我有一个机会 
 收集一些实际使用数据使用谷歌分析: 
 底线:我真的需要,新加坡节点。印度的加载时间超过1秒。 
 当我做这样的项目,人们经常问我:“你为什么这样做?你必须像痛苦。“是的,在某种程度上我 
 只喜欢做不同的事情 
 为了探索新的选择和技术,构建自己的CDN 
 很多意义。让我们解决一些问题关于这个设置。 
 让我们清楚这一点:如果一个商业供应商推出一个负担得起的推动CDN,允许我做漂亮的url,SSL和 
 自定义标题,我绝对把钱扔给他们,停止运行自己的基础设施。一样的乐趣, 
 我有足够的服务器没有运行。 
 CloudFlare是个很棒的工具很多,但如前所述,cdn下降未使用缓存的内容。在其他 
 我管理我的网站看到一个缓存率约75%的使用正确的设置。拥有自己的CDN意味着100%的 
 内容总是在缓存中,并没有额外的往返原始服务器。 
 Amazon S3有选择主机静态网站,它结合CloudFront工作。但是,它不允许 
 你为缓存设置自定义标题,好的url,等等,你需要Lambda@Edge,一个工具,允许您运行代码 
 CloudFront边缘节点。然而,Lambda@Edge发布商也有同样的问题:如果不接受请求 
 一定时间内,容器运行它关闭,需要到第二个启动。 
 谷歌AMP不仅带来了好处,当人们访问你的网站从谷歌的搜索引擎。我的大部分流量 
 不是来自谷歌,这样不会解决这个问题。所以谷歌真的只有好处,没有其他人。哦,和我 
 完全有能力建立一个快速的网站没有它们提供低能的HTML。 
 我是一个DevOps工程师专门从事传播内容。如果任何人,我应该有一个网站,是快速的 
 世界,不是吗? 
 哦,我喜欢谷歌AMP翻转了,因为这是一个可怕的技术。他们会关心。 
 现在由你:你想建立自己的CDN吗? 
 我在这里在我的源代码GitHub。发疯! 
  
 我是DevOps工程师有很强的背景在两个后端开发和操作,用 
 托管和传播内容的历史。 
  
  
 我不和上运行一个活跃的DevOps和开发社区,如果你 
 我所做的和想让我做更多的事情,你也可以支持我 
 Patreon。 
  
  
   
  URL : https://pasztor.at/blog/building-your-own-cdn?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website