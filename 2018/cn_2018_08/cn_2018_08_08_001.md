2018年7月2日。 
 提起storiesdigg下 
  
 Digg是艰难的一年。我们的首席执行官离开的前一天我加入。高级工程师已出了门,抑制生产力,把剩下的朋友。虚假投票环绕过我们的算法,销售访问我们的首页,并威胁我们的生活/修改防止其滥用。我们的配置工具为开发环境了,没有人知道如何修复它们,所以我们重新分配新员工最近离职同事的僵尸vm。 
 但是今天没有任何的。今天是预留给闹鬼Digg的逆转最大的问题在过去的两年。我们是Digg的启动一个完整的重写。今天我们致力于推出。我们同意反对进一步推迟发射。我们很确定新版本,版本4,还没有准备好。 
 开始的那一天。我们是天真的。我们的教育等。 
 如果你幸运的被邀请到我们的海绵,将仓库的办公室,感觉buzz,你可能想庆祝活动正在进行中。重写从Digg v3.5到Digg v4随意向前行军了近2年,并承诺将我们从单一的社区驱动的新闻聚合器无限个性化聚合器由混合你的社交图,有影响力的人,和全球新闻的时代精神。 
 如果我们的产品需求继续通量到前一周,Digg v4之路已经明确几年前,当Digg被谷歌熊猫更新算法。作为搜索更新了悠闲的月泡生效,我们的命运逆转像我们争吵神:我们从第一次——而且只有盈利,并保持下降,直到我们每月的交通被切断了一半。一个月,公司经过了五年的盈利能力,未来公司在自由落体和筹资从弱者的地位。 
 启动v4是我们的机会回到应有的位置在互联网的巨头,和宽敞的办公室,员工被称为“谋杀教堂”,亲切地重新安排了。在房间的中间,一个巨大的木制的桌子被定位为“战情室”。它被一圈沙发框架,其他人会支持协助。侍者托盘的黑色领带服装在房间里走动,寿司,精致的小口,冰镇的香槟。酒吧已经建好了,各种形状的饮料。人悄悄上楼,乒乓球的几场比赛。 
 开始缓慢的问题。 
 有一次,一位热情洋溢的工程师宣布整个重写可以运行在两台服务器,我们简约的QA环境更大的相反,我们非常接近与两个服务器启动我们最准确的估计。发射前一周,容量规划项目转移到我和丰富我们的勇敢的闹剧JMeter安装和生成尽可能多的性能数据,我们可以对复杂、密集、快速流沙,由重写。这不是最自信的我曾经在我的工作,我记得写一本报告公共汽车上学的书我从来没有读四年级,但是有可能我们推出没有太多是不是去上班。 
 我们怀疑它不重要,因为我们不能够秩序和安装新硬件启动之前在我们的数据中心。能力就足够了,因为它是所有。 
 上午十时左右,有人问我们什么时候启动开关,和迈克也在一边帮腔心喜的是,“我们已经开始再补充粮食给v3服务器。”我们有能力如此之小,我们决定重新塑造我们现有的服务器,然后再补充粮食给他们新的软件堆栈。这是聪明的从降低成本的角度 
 年代,但是乐观它必须带有疯狂。 
 重生的火焰吞噬了前面的基础设施,奇怪的事情发生了,或者没有发生。新网站没有出现。运营团队冲出来一个维护页面,我们收集了我们英俊的木桌上,昂贵的椅子和咬恐惧的感觉。这不是顺利的。我们没有一个回滚计划。随机的工程师自己挑选表决定我们唯一可能的选择是继续向前滚动,和我们所做的。一个小时后,旧的基础设施是完全消失了,取而代之的是Digg版本4。 
 服务器再补充粮食给、维护页面哄骗游客办公室了罗马“最后的日子”的气氛。打开香槟和酒吧流淌,乒乓球表完全占领,和其他的公司,不确定如何帮助,就Digg的最后万福马利亚已经摸索。陷害福布斯封面在大堂遗留,确实不是一个预兆。 
 天舒展,人们开始离开,但工程师们蜂拥中央表,有很多需要去做。我们已经成功地提供新的网站,但它仍然是惊人的负载下,大多数页面无法加载。集群的主要瓶颈是我们卡桑德拉。富人和我断绝了会议室和扩大使用memcache write-through-cache屏蔽卡桑德拉;几小时后的网站开始为注销用户负载。 
 登录用户,还看到错误页面当他们来到现场。罪魁祸首是重写的皇冠上的宝石,叫做MyNews,提供社会背景,你的朋友已经与每一篇文章,和合并一起活动变成一个个性化的新闻提要。这是期望发生什么,不管怎么说,在这一点上它实际上所做的是把雅致的“启动蓝色”错误页面。 
 当一天结束的时候,我们改变了默认页面为用户从MyNews TopNews,还加载的全局视图,让用户登录并使用该网站。MyNews页面仍然错误,但它足以让我们回家,醉了,打败了,幸存者重新庆祝。 
 人们慢慢地进入到办公室的第二天一早,我们重整旗鼓。MyNews被彻底打破,打破像发条每四小时,这些核心问题的背后,许多较小的问题也出现了。我们学习我们可以通过重新启动修复周期破损的每一个过程中,我们没有能够隔离哪些来源,所以我们决定先关注MyNews。 
 再一次,我和丰富的隐藏自己的一间会议室里,这一次,从头重写我们的MyNews实现的目标。当前版本写进卡桑德拉,其负载是破碎集群,打破了社会功能,和有辱人格的其他功能。我们决定重写在复述,存储数据,但是有太多的数据存储在任何服务器,所以我们需要推出一个新的实现,一个新的切分策略,和工具来管理工具。 
 和我们做了! 
 在接下来的两天,我们实现了一个分片复述,集群和成功迁移过去。它有一些缺陷,Digg的剩余的生活,我会秘密从MyNews删除大量数据集群因为我们负担不起大小正确存储必要的数据,我们不能同意要做什么,所以每次我最终删除多余的数据秘密保持网站运行,但它工作,和我们珍贵的重写飞出从门口开始一瘸一拐的跟踪。 
 真的是一瘸一拐的,需要手动重新启动的过程每四个小时。花了一个月的时间来追踪这个bug,年底前,只有三个人勒 
 英国《金融时报》的尝试。我变得如此全神贯注地理解问题,与豪尔赫和迈克在运营团队合作,我甚至不知道如果任何人走进办公室。不理解这个破损的侮辱,当大多数人下降——大概开始申请工作,因为他们有一个舔的感觉——我被困扰修好它。 
 和我们做了! 
 我们的API服务器是一个Python龙卷风服务,使Python API调用到我们后端层,称为短尾猫(前端是山猫),其中一个最经常访问的端点是用于检索用户名称或id。因为它支持检索通过名称或id,它这两个参数的默认值设置为空的列表。这是一个超级合理的事情!然而,Python只初始化默认参数的函数时第一次评估,这意味着同样的列表是用于每个调用函数。因此,如果你改变这些值,突变跨调用。 
 在这种情况下,用户id和名称附加到默认列出每一次它被称为。/小时,这些列表开始检索成千上万的用户在每个请求,压倒性的甚至memcache集群。这花了很长时间才赶上,因为我们返回的值作为一个字典,字典总是包括必要的值,它只是碰巧还包括成千上万的附加价值,因此它没有明显的方式。错误的影响被放大,因为我们假设用户不会通过重复的id,并将愉快地检索单个请求重复相同的id。 
 我们推出了最后关键的修复,Digg V4完全启动。一个星期后我们最后的首席执行官将加入。一个月后我们会有第三轮裁员。一年后我们将出售公司。但在那一刻,我们赢了。 
 我正要打我六个月的纪念日。 
 Digg V4有时是灾难性的发射的引用作为一个例子,有一个隐含的教训,我们不应该启动它。有一次,我曾经同意,但这些天来,我认为我们的决定是正确的。流量明显下降,我们失去很多钱每个月,我们最近筹集资金,知道我们不能轻易筹集更多。如果我们有推出一些伟大的事情之间的选择和可怕的东西,我们会倾向于推出一些伟大的事情,而是我们的选择最后一个swing或将在我们的蝙蝠悄无声息。 
 我很高兴我们带过去;骄傲我们幸存下来的发射。 
 另一方面,我仍然感到震惊,我们是如此不计后果的发射本身。我记得会议,我们决定继续进行发射,与迈克大力抗议。我记忆所及,我保持沉默。我希望我成长的体验,因为即使是现在,我不确定这样一群才华横溢的穿上fuckery显示。 
 @lethain lethain[在]gmail 
  
 条纹, 
 乳房, 
 Digg 
  
 关于作者。 
 版权所有,将拉森。2007 - 2018。 
  
   
  URL : https://lethain.com//digg-v4/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website